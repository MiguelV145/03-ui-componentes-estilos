import{a as we,b as ne,c as De,d as Te,e as Ne,f as Me,g as Ve,h as Ae,i as Ie,j as je,k as Re}from"./chunk-6VSJMY2T.js";import{a as Le}from"./chunk-5YX245G2.js";import{g as _e,j as H,m as be}from"./chunk-PGZKGQSR.js";import{e as he,f as Fe,i as Se,j as te,k as Ce,l as ie,m as Ee,o as Pe,q as ye,r as ke,s as O}from"./chunk-VLVOUHCV.js";import{k as fe,p as xe,r as A}from"./chunk-GOYO6SWK.js";import{Ab as F,Bb as c,Cb as p,D as B,Db as Z,Gb as T,Hb as me,Jb as g,Lb as m,Oa as se,P as $,Pb as ce,Ra as s,Rb as z,Sb as de,Tb as o,Ub as S,V as q,Vb as N,Wb as pe,Yb as y,Zb as V,_ as v,_b as ue,a as X,b as Y,da as f,dc as G,ea as _,ec as ge,fa as j,fc as ee,ga as R,gb as P,gc as ve,kc as k,na as b,q as M,r as E,sb as x,tb as h,ub as le,v as I,vb as w,wb as D,xb as u,yb as r,zb as a}from"./chunk-ZCFK76IM.js";var U=class i{activatedRoute=v(_e);currentPage=xe(this.activatedRoute.queryParamMap.pipe(I(t=>t.get("page")?+t.get("page"):1),I(t=>isNaN(t)?1:t)),{initialValue:1});static \u0275fac=function(e){return new(e||i)};static \u0275prov=q({token:i,factory:i.\u0275fac,providedIn:"root"})};var oe=()=>[],ae=i=>({page:i});function qe(i,t){if(i&1){let e=T();r(0,"button",3),g("click",function(){let l=f(e).$implicit,d=m();return _(d.activePage.set(l))}),o(1),a()}if(i&2){let e=t.$implicit,n=m();z("btn-primary",e===n.activePage()),u("routerLink",y(5,oe))("queryParams",V(6,ae,e)),s(),N(" ",e," ")}}var J=class i{pages=k(0);currentPage=k(1);activePage=ve(this.currentPage);getPagesList=ge(()=>{let t=this.pages(),e=this.activePage();if(t<=5)return Array.from({length:t},(d,C)=>C+1);let n=Math.max(1,e-2),l=Math.min(t,n+4);return Array.from({length:l-n+1},(d,C)=>n+C)});previousPage(){this.activePage()>1&&this.activePage.update(t=>t-1)}nextPage(){this.activePage()<this.pages()&&this.activePage.update(t=>t+1)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-pagination-component"]],inputs:{pages:[1,"pages"],currentPage:[1,"currentPage"]},decls:7,vars:12,consts:[[1,"join","flex","justify-center","items-center","gap-2"],[1,"join-item","btn",3,"click","routerLink","queryParams","disabled"],[1,"join-item","btn",3,"btn-primary","routerLink","queryParams"],[1,"join-item","btn",3,"click","routerLink","queryParams"]],template:function(e,n){e&1&&(r(0,"div",0)(1,"button",1),g("click",function(){return n.previousPage()}),o(2,"\xAB"),a(),w(3,qe,2,8,"button",2,le),r(5,"button",1),g("click",function(){return n.nextPage()}),o(6,"\xBB"),a()()),e&2&&(s(),u("routerLink",y(6,oe))("queryParams",V(7,ae,n.activePage()-1))("disabled",n.activePage()===1),s(2),D(n.getPagesList()),s(2),u("routerLink",y(9,oe))("queryParams",V(10,ae,n.activePage()+1))("disabled",n.activePage()===n.pages()))},dependencies:[H],encapsulation:2,changeDetection:0})};var K=class i{simpsonsCount=k.required();totalPages=k.required();static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-hero-simpsons"]],inputs:{simpsonsCount:[1,"simpsonsCount"],totalPages:[1,"totalPages"]},decls:28,vars:2,consts:[["role","banner",1,"hero","bg-linear-to-r","from-yellow-400","via-yellow-500","to-orange-400","text-base-content"],[1,"hero-content","text-center","py-12"],[1,"max-w-md"],[1,"text-5xl","font-bold","text-black","drop-shadow-md"],[1,"py-6","text-lg","text-gray-800","font-medium"],[1,"stats","stats-horizontal","shadow-lg","bg-white/90"],[1,"stat"],[1,"stat-figure","text-primary"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"inline-block","w-8","h-8","stroke-current"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0zM7 10a2 2 0 11-4 0 2 2 0z"],[1,"stat-title","text-gray-700"],[1,"stat-value","text-primary"],[1,"stat-desc","text-gray-600"],[1,"stat-figure","text-secondary"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"],[1,"stat-value","text-secondary"]],template:function(e,n){e&1&&(c(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),o(4,"Simpsons"),p(),c(5,"p",4),o(6," Explora el universo de la familia m\xE1s famosa de Springfield "),p(),c(7,"div",5)(8,"div",6)(9,"div",7),j(),c(10,"svg",8),Z(11,"path",9),p()(),R(),c(12,"div",10),o(13,"Personajes"),p(),c(14,"div",11),o(15),p(),c(16,"div",12),o(17,"Total de registros"),p()(),c(18,"div",6)(19,"div",13),j(),c(20,"svg",8),Z(21,"path",14),p()(),R(),c(22,"div",10),o(23,"P\xE1ginas"),p(),c(24,"div",15),o(25),p(),c(26,"div",12),o(27,"Total disponibles"),p()()()()()()),e&2&&(s(15),N(" ",n.simpsonsCount()," "),s(10),S(n.totalPages()))},encapsulation:2,changeDetection:0})};var ze=(i,t)=>t.label;function Ge(i,t){if(i&1&&(c(0,"a",1),o(1),p()),i&2){let e=m().$implicit;me("href",e.link,se),s(),S(e.label)}}function He(i,t){if(i&1&&(c(0,"span"),o(1),p()),i&2){let e=m().$implicit;s(),S(e.label)}}function Oe(i,t){if(i&1&&(c(0,"li"),x(1,Ge,2,2,"a",1)(2,He,2,1,"span"),p()),i&2){let e=t.$implicit;s(),h(e.link?1:2)}}var Q=class i{items=k([]);static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-breadcrumbs"]],inputs:{items:[1,"items"]},decls:4,vars:0,consts:[[1,"breadcrumbs","text-sm","px-6","py-3","bg-base-200"],[1,"link","link-hover",3,"href"]],template:function(e,n){e&1&&(c(0,"div",0)(1,"ul"),w(2,Oe,3,1,"li",null,ze),p()()),e&2&&(s(2),D(n.items()))},encapsulation:2,changeDetection:0})};var W=class i{firestore=v(Fe);authService=v(O);favorites=b([]);loading=b(!1);addFavorite(t,e,n){let l=this.authService.currentUser();if(!l)throw new Error("Usuario no autenticado");let d={nombre:t,customName:n||t,image:e,userId:l.uid,createdAt:new Date},C=te(this.firestore,"favorites");return M(Se(C,Y(X({},d),{createdAt:he.fromDate(d.createdAt)})))}getFavorites(){let t=this.authService.currentUser();if(!t)return M([[]]);this.loading.set(!0);let e=te(this.firestore,"favorites"),n=Pe(e,ke("userId","==",t.uid));return M(Ee(n)).pipe(I(l=>{let d=l.docs.map(C=>Y(X({id:C.id},C.data()),{createdAt:C.data().createdAt.toDate()}));return this.favorites.set(d),this.loading.set(!1),d}))}updateFavorite(t,e){let n=ie(this.firestore,"favorites",t);return M(ye(n,{customName:e}))}deleteFavorite(t){let e=ie(this.firestore,"favorites",t);return M(Ce(e))}isFavorite(t){return this.favorites().some(e=>e.nombre===t)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=q({token:i,factory:i.\u0275fac,providedIn:"root"})};var Ue=()=>({label:"Inicio",link:"/"}),Je=()=>({label:"Simpsons",link:"/simpsons"}),Ke=()=>({label:"Personajes"}),Qe=(i,t,e)=>[i,t,e],We=i=>["/simpsons",i],$e=(i,t)=>t.id;function Xe(i,t){i&1&&(r(0,"div",4),F(1,"span",16),a())}function Ye(i,t){if(i&1){let e=T();r(0,"div",5)(1,"select",17,0),g("change",function(){f(e);let l=ce(2),d=m();return _(d.charactersPerPage.set(+l.value))}),r(3,"option",18),o(4,"10"),a(),r(5,"option",19),o(6,"20"),a(),r(7,"option",20),o(8,"50"),a(),r(9,"option",21),o(10,"100"),a()(),F(11,"app-pagination-component",22)(12,"div",23),a()}if(i&2){let e=m();s(11),u("pages",e.totalPages())("currentPage",e.paginationService.currentPage())}}function Ze(i,t){i&1&&(r(0,"button",26),o(1," \u2B50 Guardado "),a())}function et(i,t){if(i&1){let e=T();r(0,"button",28),g("click",function(){f(e);let l=m().$implicit,d=m(2);return _(d.addToFavorites(l))}),o(1," \u2606 Agregar "),a()}}function tt(i,t){if(i&1&&(r(0,"tr")(1,"td"),o(2),a(),r(3,"td"),o(4),a(),r(5,"td"),o(6),a(),r(7,"td")(8,"span"),o(9),a()(),r(10,"td")(11,"a",25),o(12," Ver Detalle "),a()(),r(13,"td"),x(14,Ze,2,0,"button",26)(15,et,2,0,"button",27),a()()),i&2){let e=t.$implicit,n=m(2);s(2),S(e.id),s(2),S(e.name),s(2),S(e.occupation),s(2),de(pe("badge badge-",e.status==="Alive"?"success":"error")),s(),N(" ",e.status," "),s(2),u("routerLink",V(9,We,e.id)),s(3),h(n.isFavorite(e.name)?14:15)}}function it(i,t){if(i&1&&(r(0,"div",6)(1,"table",24)(2,"thead")(3,"tr")(4,"th"),o(5,"ID"),a(),r(6,"th"),o(7,"Nombre"),a(),r(8,"th"),o(9,"Ocupaci\xF3n"),a(),r(10,"th"),o(11,"Estado"),a(),r(12,"th"),o(13,"Detalles"),a(),r(14,"th"),o(15,"Favorito"),a()()(),r(16,"tbody"),w(17,tt,16,11,"tr",null,$e),a()()()),i&2){let e=m();s(17),D(e.simpsonsResource.value().results)}}function nt(i,t){i&1&&F(0,"span",12)}function ot(i,t){i&1&&o(0," \u{1F504} Actualizar ")}function at(i,t){i&1&&(r(0,"div",13),F(1,"span",16),a())}function rt(i,t){i&1&&(r(0,"div",14),j(),r(1,"svg",29),F(2,"path",30),a(),R(),r(3,"span"),o(4,"No tienes favoritos a\xFAn. \xA1Agrega algunos personajes de la tabla de arriba!"),a()())}function st(i,t){if(i&1){let e=T();r(0,"form",36)(1,"input",37),g("keyup.enter",function(){f(e);let l=m(3);return _(l.saveEditedFavorite())})("keyup.escape",function(){f(e);let l=m(3);return _(l.cancelEditingFavorite())}),a(),r(2,"div",38)(3,"button",39),g("click",function(){f(e);let l=m(3);return _(l.saveEditedFavorite())}),o(4," \u2713 Guardar "),a(),r(5,"button",40),g("click",function(){f(e);let l=m(3);return _(l.cancelEditingFavorite())}),o(6," \u2715 Cancelar "),a()()()}if(i&2){let e,n=m(3);u("formGroup",n.editForm),s(),z("input-error",((e=n.editForm.get("customName"))==null?null:e.invalid)&&((e=n.editForm.get("customName"))==null?null:e.touched)),s(2),u("disabled",n.editForm.invalid)}}function lt(i,t){if(i&1){let e=T();r(0,"p",41)(1,"span",42),o(2,"Alias:"),a(),F(3,"br"),o(4),a(),r(5,"div",43)(6,"button",44),g("click",function(){f(e);let l=m().$implicit,d=m(2);return _(d.startEditingFavorite(l))}),o(7," \u270F\uFE0F Editar "),a(),r(8,"button",45),g("click",function(){f(e);let l=m().$implicit,d=m(2);return _(d.removeFromFavorites(l.id))}),o(9," \u{1F5D1}\uFE0F Eliminar "),a()()}if(i&2){let e=m().$implicit;s(4),N(" ",e.customName," ")}}function mt(i,t){if(i&1&&(r(0,"div",31)(1,"figure",32),F(2,"img",33),a(),r(3,"div",34)(4,"h3",35),o(5),a(),x(6,st,7,4,"form",36)(7,lt,10,1),a()()),i&2){let e=t.$implicit,n=m(2);s(2),u("alt",e.nombre),s(3),S(e.nombre),s(),h(n.editingFavoriteId()===e.id?6:7)}}function ct(i,t){if(i&1&&(r(0,"div",15),w(1,mt,8,3,"div",31,$e),a()),i&2){let e=m();s(),D(e.favorites())}}var Be=class i{simpsonsService=v(Le);paginationService=v(U);favoritesService=v(W);authService=v(O);addFavoriteAction=b(null);deleteFavoriteAction=b(null);updateFavoriteAction=b(null);charactersPerPage=b(10);totalPages=b(0);constructor(){ee(()=>{this.simpsonsResource.hasValue()&&this.totalPages.set(this.simpsonsResource.value().pages)}),this.editForm=this.fb.group({customName:["",[ne.required,ne.minLength(2)]]}),ee(()=>{this.authService.currentUser()&&this.reloadFavoritesTrigger.update(e=>e+1)})}simpsonsResource=A({params:()=>({page:this.paginationService.currentPage()-1,limit:this.charactersPerPage()}),stream:({params:t})=>this.simpsonsService.getCharactersOptions({offset:t.page,limit:t.limit})});fb=v(je);reloadFavoritesTrigger=b(0);favoritesResource=A({params:()=>({reload:this.reloadFavoritesTrigger()}),stream:({params:t})=>this.authService.currentUser()?this.favoritesService.getFavorites():E([])});addFavoriteResource=A({params:()=>this.addFavoriteAction(),stream:({params:t})=>t?this.favoritesService.addFavorite(t.nombre,t.imagen).pipe($(()=>{G(()=>{this.reloadFavoritesTrigger.update(e=>e+1),alert("\xA1Agregado a favoritos!")})}),B(e=>(console.error("Error al agregar favorito:",e),alert("Error al agregar a favoritos: "+e.message),E(null)))):E(null)});deleteFavoriteResource=A({params:()=>this.deleteFavoriteAction(),stream:({params:t})=>t?this.favoritesService.deleteFavorite(t).pipe($(()=>{G(()=>{this.reloadFavoritesTrigger.update(e=>e+1),alert("Eliminado de favoritos")})}),B(e=>(console.error("Error al eliminar favorito:",e),E(null)))):E(null)});updateFavoriteResource=A({params:()=>this.updateFavoriteAction(),stream:({params:t})=>t?this.favoritesService.updateFavorite(t.id,t.customName).pipe($(()=>{G(()=>{this.reloadFavoritesTrigger.update(e=>e+1),this.cancelEditingFavorite(),alert("Nombre actualizado")})}),B(e=>(console.error("Error al actualizar favorito:",e),E(null)))):E(null)});editingFavoriteId=b(null);editForm;favorites=()=>this.favoritesResource.value()||[];loadingFavorites=this.favoritesResource.isLoading;reloadFavorites(){this.reloadFavoritesTrigger.update(t=>t+1)}addToFavorites(t){let e=t.name||t.character,n=t.image||"";if(!e){console.error("Nombre del personaje no encontrado"),alert("Error: No se pudo obtener el nombre del personaje");return}this.addFavoriteAction.set({nombre:e,imagen:n})}removeFromFavorites(t){confirm("\xBFEliminar de favoritos?")&&this.deleteFavoriteAction.set(t)}startEditingFavorite(t){this.editingFavoriteId.set(t.id),this.editForm.patchValue({customName:t.customName})}saveEditedFavorite(){if(this.editForm.invalid){this.editForm.markAllAsTouched();return}let t=this.editingFavoriteId(),e=this.editForm.value.customName;t&&e&&this.updateFavoriteAction.set({id:t,customName:e})}cancelEditingFavorite(){this.editingFavoriteId.set(null),this.editForm.reset()}isFavorite(t){return this.favorites().some(e=>e.nombre===t)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=P({type:i,selectors:[["app-simpsons-page"]],decls:17,vars:16,consts:[["selectPerPage",""],[1,"p-8"],[3,"items"],[3,"simpsonsCount","totalPages"],[1,"flex","justify-center","items-center","h-64"],[1,"flex","gap-2","items-center","h-20","mb-4"],[1,"overflow-x-auto","mb-12"],[1,"divider"],[1,"mt-8"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-2xl","font-bold"],[1,"btn","btn-sm","btn-ghost",3,"click","disabled"],[1,"loading","loading-spinner","loading-sm"],[1,"flex","justify-center","items-center","py-12"],[1,"alert","alert-info"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4"],[1,"loading","loading-spinner","loading-lg"],[1,"select","select-bordered","w-32",3,"change"],["value","10"],["value","20"],["value","50"],["value","100"],[3,"pages","currentPage"],[1,"flex","flex-1"],[1,"table"],[1,"btn","btn-sm","btn-primary",3,"routerLink"],["disabled","",1,"btn","btn-sm","btn-ghost","text-warning"],[1,"btn","btn-sm","btn-outline","btn-warning"],[1,"btn","btn-sm","btn-outline","btn-warning",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"stroke-current","shrink-0","w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"card","bg-base-100","shadow-xl","border","border-base-200"],[1,"px-4","pt-4"],[1,"rounded-xl","h-48","w-full","object-contain","bg-base-200",3,"src","alt"],[1,"card-body"],[1,"card-title","text-sm"],[1,"form-control",3,"formGroup"],["type","text","formControlName","customName","placeholder","Nombre personalizado",1,"input","input-bordered","input-sm","mb-2",3,"keyup.enter","keyup.escape"],[1,"flex","gap-2"],["type","button",1,"btn","btn-xs","btn-success","flex-1",3,"click","disabled"],["type","button",1,"btn","btn-xs","btn-ghost","flex-1",3,"click"],[1,"text-xs","opacity-70"],[1,"font-semibold"],[1,"card-actions","justify-end","mt-2"],[1,"btn","btn-xs","btn-ghost",3,"click"],[1,"btn","btn-xs","btn-error","btn-outline",3,"click"]],template:function(e,n){if(e&1&&(r(0,"section",1),F(1,"app-breadcrumbs",2)(2,"app-hero-simpsons",3),x(3,Xe,2,0,"div",4),x(4,Ye,13,2,"div",5),x(5,it,19,0,"div",6),F(6,"div",7),r(7,"div",8)(8,"div",9)(9,"h2",10),o(10,"\u2B50 Mis Favoritos"),a(),r(11,"button",11),g("click",function(){return n.reloadFavorites()}),x(12,nt,1,0,"span",12)(13,ot,1,0),a()(),x(14,at,2,0,"div",13)(15,rt,5,0,"div",14)(16,ct,3,0,"div",15),a()()),e&2){let l;s(),u("items",ue(12,Qe,y(9,Ue),y(10,Je),y(11,Ke))),s(),u("simpsonsCount",((l=n.simpsonsResource.value())==null?null:l.count)??0)("totalPages",n.totalPages()),s(),h(n.simpsonsResource.isLoading()?3:-1),s(),h(n.simpsonsResource.hasValue()?4:-1),s(),h(n.simpsonsResource.hasValue()?5:-1),s(6),u("disabled",n.loadingFavorites()),s(),h(n.loadingFavorites()?12:13),s(2),h(n.loadingFavorites()?14:n.favorites().length===0?15:16)}},dependencies:[fe,be,H,J,K,Q,Re,Ne,Ae,Ie,we,De,Te,Me,Ve],encapsulation:2})};export{Be as SimpsonsPage};
